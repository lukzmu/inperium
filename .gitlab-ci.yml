image: python:3.12-slim

stages:
  - lint
  - test
  - publish

before_script:
  - pip install poetry
  - poetry install
  - export PYTHONPATH="$PYTHONPATH:./src"

ğŸ¶ ruff:
  stage: lint
  script: poetry run ruff check src/

ğŸ° mypy:
  stage: lint
  script: poetry run mypy src/

ğŸ§ª pytest:
  stage: test
  needs:
    - ğŸ¶ ruff
    - ğŸ° mypy
  script:
    - apt-get update -y && apt-get install -y curl
    - poetry run pytest --cov=src --cov-report=json
    - bash <(curl -s https://codecov.io/bash)

pages:
  stage: publish
  only: 
    - main
  needs:
    - ğŸ§ª pytest
  script: 
    - cd src
    - poetry run pelican content -s core/settings.py -o ../public
  artifacts:
    paths:
      - public
