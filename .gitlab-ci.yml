image: python:3.12-slim

stages:
  - lint
  - publish

before_script:
  - pip install poetry
  - poetry install
  - export PYTHONPATH="$PYTHONPATH:./src"

ğŸ–¤ black:
  stage: lint
  script: poetry run black --check --diff src/

ğŸ¶ ruff:
  stage: lint
  script: poetry run ruff src/

ğŸ° mypy:
  stage: lint
  script: poetry run mypy src/

pages:
  stage: publish
  only: 
    - main
  needs:
    - ğŸ–¤ black
    - ğŸ¶ ruff
    - ğŸ° mypy
  script: 
    - cd src
    - poetry run pelican content -s core/settings.py -o ../public
  artifacts:
    paths:
      - public
